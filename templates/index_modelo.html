<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>ERP Clínicas — Horários de Médicos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --brand:#0f766e; /* teal-700 */
      --brand-600:#0d9488;
      --ink:#0f172a;
      --sidebar-w: 260px;
      --sidebar-w-collapsed: 72px;
    }
    *{ font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial }
    .tick-bg{
      background-image: linear-gradient(to right, rgba(2,6,23,0.12) 1px, transparent 1px);
      background-size: calc(100%/48) 100%;
      background-repeat: repeat-x;
    }
    input[type="range"]{ accent-color: var(--brand); }
    .sidebar-collapsed .hide-when-collapsed{ display:none; }
    .sidebar-collapsed .sidebar{ width: var(--sidebar-w-collapsed); }
    .sidebar{ width: var(--sidebar-w); transition: width .2s ease; }
    .main{ transition: margin-left .2s ease; }

    /* Tabela: garantir alinhamento da coluna de ação */
    .col-acao{ width: 180px; }              /* largura fixa da coluna */
    .btn-agendar{ width: 104px; }           /* largura fixa do botão Agendar */
    .btn-del{ width: 36px; height: 36px; }  /* lixeira quadrada */
    /* Filas com altura consistente */
    #grid tbody tr > td{ vertical-align: middle; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div id="app" class="min-h-screen flex">
    <!-- Sidebar retrátil -->
    <aside class="sidebar bg-white border-r border-slate-200 sticky top-0 h-screen p-3">
      <div class="flex items-center justify-between mb-3">
        <button id="btnToggleSidebar" class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50" title="Recolher/Expandir">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M8 6l8 6-8 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="hide-when-collapsed flex items-center gap-2">
          <div class="w-8 h-8 rounded-xl bg-[var(--brand)]/10 grid place-items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--brand)]" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M9 12h6M12 9v6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <rect x="3" y="4" width="18" height="16" rx="3" stroke-width="1.5"></rect>
            </svg>
          </div>
          <span class="text-sm font-semibold">ERP Clínicas</span>
        </div>
      </div>

      <nav class="space-y-1">
        <a href="#horarios" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-100 text-slate-900 font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="3" y="4" width="18" height="16" rx="2" stroke-width="1.8"/>
            <path d="M3 9h18" stroke-width="1.8"/>
          </svg>
          <span class="hide-when-collapsed">Horários</span>
        </a>
        <a href="#" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="8" r="4" stroke-width="1.8"/>
            <path d="M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke-width="1.8"/>
          </svg>
          <span class="hide-when-collapsed">Cadastro de Médicos</span>
        </a>
      </nav>
    </aside>

    <!-- Conteúdo CENTRALIZADO -->
    <div class="main flex-1 min-w-0">
      <div class="max-w-5xl mx-auto px-4 lg:px-6 py-6" id="horarios">

        <!-- Form dinâmico -->
        <section class="bg-white border border-slate-200 rounded-2xl p-6">
          <h3 class="text-lg font-semibold mb-4">Adicionar horários por expediente</h3>

          <form id="formAdd" class="grid grid-cols-1 md:grid-cols-12 gap-4">
            <!-- Médico -->
            <div class="md:col-span-4">
              <label class="text-sm text-slate-600">Médico</label>
              <select id="selMedico" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-600)]"></select>
            </div>

            <!-- CRM (auto) -->
            <div class="md:col-span-3">
              <label class="text-sm text-slate-600">CRM</label>
              <input id="autoCRM" type="text" readonly class="w-full mt-1 px-3 py-2 border rounded-lg bg-slate-50 text-slate-700">
            </div>

            <!-- Especialidade (auto) -->
            <div class="md:col-span-5">
              <label class="text-sm text-slate-600">Especialidade</label>
              <input id="autoEsp" type="text" readonly class="w-full mt-1 px-3 py-2 border rounded-lg bg-slate-50 text-slate-700">
            </div>

            <!-- Datas -->
            <div class="md:col-span-3">
              <label class="text-sm text-slate-600">Data de início</label>
              <input required id="dataInicio" type="date" class="w-full mt-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-600)]">
            </div>
            <div class="md:col-span-3">
              <label class="text-sm text-slate-600">Data de fim</label>
              <input required id="dataFim" type="date" class="w-full mt-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-600)]">
            </div>

            <!-- Incluir sábado / domingo -->
            <div class="md:col-span-6 flex items-end gap-4">
              <label class="inline-flex items-center gap-2 mt-6">
                <input id="incluiSab" type="checkbox" class="w-4 h-4 rounded border-slate-300 text-[var(--brand)] focus:ring-[var(--brand-600)]">
                <span class="text-sm">Incluir sábado</span>
              </label>
              <label class="inline-flex items-center gap-2 mt-6">
                <input id="incluiDom" type="checkbox" class="w-4 h-4 rounded border-slate-300 text-[var(--brand)] focus:ring-[var(--brand-600)]">
                <span class="text-sm">Incluir domingo</span>
              </label>
            </div>

            <!-- INÍCIO (cartão) -->
            <div class="md:col-span-12 grid grid-cols-1 gap-4">
              <div class="rounded-xl border border-slate-200 p-4 bg-slate-50">
                <div class="flex items-center justify-between">
                  <p class="text-sm text-slate-600">Início do expediente</p>
                  <span id="lblInicio" class="text-xs px-2 py-1 rounded-full bg-emerald-100 text-emerald-800 font-medium">08:00</span>
                </div>
                <div class="mt-3">
                  <input id="rngInicio" type="range" min="0" max="47" step="1" value="16" class="w-full tick-bg">
                  <div class="flex justify-between text-[10px] text-slate-500 mt-1">
                    <span>00:00</span><span>06:00</span><span>12:00</span><span>18:00</span><span>23:30</span>
                  </div>
                </div>
              </div>

              <!-- FIM (cartão) -->
              <div class="rounded-xl border border-slate-200 p-4 bg-slate-50">
                <div class="flex items-center justify-between">
                  <p class="text-sm text-slate-600">Fim do expediente</p>
                  <span id="lblFim" class="text-xs px-2 py-1 rounded-full bg-sky-100 text-sky-800 font-medium">12:00</span>
                </div>
                <div class="mt-3">
                  <input id="rngFim" type="range" min="0" max="47" step="1" value="24" class="w-full tick-bg">
                  <div class="flex justify-between text-[10px] text-slate-500 mt-1">
                    <span>00:00</span><span>06:00</span><span>12:00</span><span>18:00</span><span>23:30</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Status inicial + ações -->
            <div class="md:col-span-12 flex items-center gap-3">
              <label class="text-sm text-slate-600">Status inicial:</label>
              <select id="fStatus" class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-600)]">
                <option value="livre">livre</option>
                <option value="ocupado">ocupado</option>
              </select>

              <div class="ml-auto flex gap-2">
                <button type="submit" class="px-3 py-2 rounded-lg text-sm bg-[var(--brand)] text-white hover:bg-[var(--brand-600)]">Gerar horários</button>
                <button id="btnLimparForm" type="button" class="px-3 py-2 rounded-lg text-sm border border-slate-300 bg-white hover:bg-slate-50">Limpar</button>
              </div>
            </div>
          </form>

          <p class="text-xs text-slate-500 mt-3">
            Geração a cada 30 min, pulando <b>12:00–13:00</b> e <b>18:00–19:00</b>. Intervalo de datas é <b>inclusivo</b>.
          </p>
        </section>

        <!-- Filtros (sem CSV/print) -->
        <section class="bg-white border border-slate-200 rounded-2xl p-6 mt-6">
          <div class="grid md:grid-cols-6 gap-3">
            <div class="md:col-span-3">
              <label class="text-sm text-slate-600">Buscar por médico</label>
              <input id="filtroMedico" type="text" class="w-full mt-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-600)]" placeholder="Digite o nome">
            </div>
            <div>
              <label class="text-sm text-slate-600">Dia da semana</label>
              <select id="filtroDia" class="w-full mt-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-600)]">
                <option value="">Todos</option>
                <option>Segunda</option><option>Terça</option><option>Quarta</option><option>Quinta</option>
                <option>Sexta</option><option>Sábado</option><option>Domingo</option>
              </select>
            </div>
            <div>
              <label class="text-sm text-slate-600">Especialidade</label>
              <select id="filtroEsp" class="w-full mt-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-600)]">
                <option value="">Todas</option>
              </select>
            </div>
            <div class="flex items-end">
              <label class="inline-flex items-center gap-2 mt-6">
                <input id="chkLivres" type="checkbox" class="w-4 h-4 rounded border-slate-300 text-[var(--brand)] focus:ring-[var(--brand-600)]">
                <span class="text-sm">Apenas livres</span>
              </label>
            </div>
          </div>
          <p id="contador" class="text-xs text-slate-500 mt-3">—</p>
        </section>

        <!-- Tabela -->
        <section class="bg-white border border-slate-200 rounded-2xl overflow-hidden mt-6">
          <div class="px-4 py-3 border-b bg-teal-50 text-[var(--ink)]/80">
            <strong>Tabela de horários</strong> · clique no cabeçalho para ordenar
          </div>

          <div class="p-4">
            <table id="grid" class="w-full border-separate border-spacing-y-2">
              <thead>
                <tr class="text-left text-xs uppercase tracking-wide text-slate-500">
                  <th data-sort="id" class="cursor-pointer px-3 py-2">ID</th>
                  <th data-sort="medico" class="cursor-pointer px-3 py-2">Médico</th>
                  <th data-sort="crm" class="cursor-pointer px-3 py-2">CRM</th>
                  <th data-sort="especialidade" class="cursor-pointer px-3 py-2">Especialidade</th>
                  <th data-sort="dia" class="cursor-pointer px-3 py-2">Dia</th>
                  <th data-sort="data" class="cursor-pointer px-3 py-2">Data</th>
                  <th data-sort="hora" class="cursor-pointer px-3 py-2">Hora</th>
                  <th data-sort="status" class="cursor-pointer px-3 py-2">Status</th>
                  <th class="px-3 py-2 col-acao">Ação</th>
                </tr>
              </thead>
              <tbody id="tbody">
                <!-- linhas via JS -->
              </tbody>
            </table>
          </div>
        </section>

        <footer class="py-6 text-xs text-slate-500 text-center">© ERP Clínicas — protótipo front-end (dados fictícios).</footer>
      </div>
    </div>
  </div>

<script>
/* -------------------- Cadastros de médicos (fake DB) -------------------- */
const medicos = [
  { nome: "Dra. Ana Martins", crm: "123456-SP", especialidade: "Cardiologia" },
  { nome: "Dr. Bruno Souza", crm: "987654-SP", especialidade: "Dermatologia" },
  { nome: "Dra. Carla Nunes", crm: "456789-SP", especialidade: "Pediatria" },
  { nome: "Dr. Diego Ramos", crm: "112233-SP", especialidade: "Ortopedia" },
  { nome: "Dra. Elisa Prado", crm: "334455-SP", especialidade: "Ginecologia" },
  { nome: "Dr. Fabrício Lima", crm: "667788-SP", especialidade: "Neurologia" },
  { nome: "Dra. Giselle Rocha", crm: "778899-SP", especialidade: "Endocrinologia" },
  { nome: "Dr. Henrique Pires", crm: "889900-SP", especialidade: "Oftalmologia" }
];

/* -------------------- Dados de horários -------------------- */
let data = [
  {id: 101, medico: "Dra. Ana Martins", crm: "123456-SP", especialidade: "Cardiologia", dia:"Segunda", data:"2025-10-20", hora:"09:00", status:"livre"},
  {id: 102, medico: "Dra. Ana Martins", crm: "123456-SP", especialidade: "Cardiologia", dia:"Segunda", data:"2025-10-20", hora:"09:30", status:"ocupado"},
  {id: 103, medico: "Dr. Bruno Souza", crm: "987654-SP", especialidade: "Dermatologia", dia:"Terça", data:"2025-10-21", hora:"10:00", status:"livre"},
  {id: 104, medico: "Dr. Bruno Souza", crm: "987654-SP", especialidade: "Dermatologia", dia:"Terça", data:"2025-10-21", hora:"10:30", status:"marcado"},
];

/* -------------------- Utilitários -------------------- */
const idxToTime = idx => { const minutes = idx*30; const h = String(Math.floor(minutes/60)).padStart(2,'0'); const m = String(minutes%60).padStart(2,'0'); return `${h}:${m}`; };
const weekDayPT = d => ["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"][d];
const isMealBreakIdx = idx => (idx===24||idx===25||idx===36||idx===37); // 12:00,12:30,18:00,18:30

let currentSort = { key: 'data', dir: 'asc' };

const el = s => document.querySelector(s);
const app = el('#app');
const tbody = el('#tbody');
const filtroMedico = el('#filtroMedico');
const filtroDia = el('#filtroDia');
const filtroEsp = el('#filtroEsp');
const chkLivres = el('#chkLivres');
const contador = el('#contador');

const selMedico = el('#selMedico');
const autoCRM = el('#autoCRM');
const autoEsp = el('#autoEsp');
const dataInicio = el('#dataInicio');
const dataFim = el('#dataFim');
const incluiSab = el('#incluiSab');
const incluiDom = el('#incluiDom');

const rngInicio = el('#rngInicio');
const rngFim = el('#rngFim');
const lblInicio = el('#lblInicio');
const lblFim = el('#lblFim');
const fStatus = el('#fStatus');

/* Sidebar toggle */
el('#btnToggleSidebar').addEventListener('click', ()=> app.classList.toggle('sidebar-collapsed'));

/* Inicialização */
function initMedicosSelect(){
  selMedico.innerHTML = '<option value="">Selecione um médico...</option>' +
    medicos.map((m,i)=>`<option value="${i}">${m.nome}</option>`).join('');
}
function preencherEspecialidadesFiltro(){
  const set = new Set(data.map(r => r.especialidade));
  const current = filtroEsp.value;
  filtroEsp.innerHTML = `<option value="">Todas</option>` + [...set].sort().map(e=>`<option>${e}</option>`).join('');
  if (current) filtroEsp.value = current;
}

/* Render tabela */
function render(){
  const filtroNome = filtroMedico.value.trim().toLowerCase();
  const diaSel = filtroDia.value;
  const espSel = filtroEsp.value;
  const apenasLivres = chkLivres.checked;

  let rows = data.filter(r=>{
    const okNome = !filtroNome || r.medico.toLowerCase().includes(filtroNome);
    const okDia = !diaSel || r.dia === diaSel;
    const okEsp = !espSel || r.especialidade === espSel;
    const okLivre = !apenasLivres || r.status === 'livre';
    return okNome && okDia && okEsp && okLivre;
  });

  rows.sort((a,b)=>{
    let A=a[currentSort.key], B=b[currentSort.key];
    if(currentSort.key==='data'){ A = new Date(a.data); B = new Date(b.data); }
    if(A<B) return currentSort.dir==='asc'?-1:1;
    if(A>B) return currentSort.dir==='asc'?1:-1;
    if (a.data===b.data && a.hora!==b.hora) return a.hora<b.hora ? (currentSort.dir==='asc'?-1:1) : (currentSort.dir==='asc'?1:-1);
    return 0;
  });

  tbody.innerHTML = rows.map(r=>{
    const chip =
      r.status==='livre'
        ? `<span class="px-2 py-1 text-xs rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200">livre</span>`
      : r.status==='ocupado'
        ? `<span class="px-2 py-1 text-xs rounded-full bg-amber-50 text-amber-700 border border-amber-200">ocupado</span>`
        : `<span class="px-2 py-1 text-xs rounded-full bg-sky-50 text-sky-700 border border-sky-200">marcado</span>`;

    const canAgendar = r.status==='livre';

    return `
    <tr class="bg-white hover:bg-slate-50 transition">
      <td class="px-3 py-2 text-sm text-slate-600">${r.id}</td>
      <td class="px-3 py-2 text-sm font-medium text-slate-900">${r.medico}</td>
      <td class="px-3 py-2 text-sm text-slate-600">${r.crm}</td>
      <td class="px-3 py-2 text-sm">${r.especialidade}</td>
      <td class="px-3 py-2 text-sm">${r.dia}</td>
      <td class="px-3 py-2 text-sm tabular-nums">${r.data}</td>
      <td class="px-3 py-2 text-sm tabular-nums">${r.hora}</td>
      <td class="px-3 py-2 text-sm">${chip}</td>
      <td class="px-3 py-2 col-acao">
        <div class="flex items-center justify-end gap-2">
          <button ${canAgendar?'':'disabled'} data-id="${r.id}"
            class="btn-agendar px-3 py-1.5 rounded-md text-sm ${canAgendar?'bg-[var(--brand)] text-white hover:bg-[var(--brand-600)]':'bg-slate-200 text-slate-500 cursor-not-allowed'}">
            ${canAgendar?'Agendar':'—'}
          </button>
          <button title="Excluir linha" data-del="${r.id}" class="btn-del rounded-md border border-slate-300 hover:bg-slate-100 grid place-items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M3 6h18" stroke-width="1.8"/>
              <path d="M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke-width="1.8"/>
              <path d="M10 10v8M14 10v8" stroke-width="1.8"/>
              <path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" stroke-width="1.8"/>
            </svg>
          </button>
        </div>
      </td>
    </tr>`;
  }).join('');

  contador.textContent =
    `${rows.length} resultado(s)` +
    `${apenasLivres?' · apenas livres':''}` +
    `${filtroMedico.value ? ` · médico contém “${filtroMedico.value.trim()}”`:''}` +
    `${filtroDia.value ? ` · ${filtroDia.value}`:''}` +
    `${filtroEsp.value ? ` · ${filtroEsp.value}`:''}`;
}

/* Ordenação */
document.querySelectorAll('th[data-sort]').forEach(th=>{
  th.addEventListener('click', ()=>{
    const key = th.getAttribute('data-sort');
    if(currentSort.key===key){ currentSort.dir = currentSort.dir==='asc'?'desc':'asc'; }
    else { currentSort.key = key; currentSort.dir = 'asc'; }
    render();
  });
});

/* Filtros */
[filtroMedico, filtroDia, filtroEsp, chkLivres].forEach(elm=> elm.addEventListener('input', render));

/* Ações na tabela */
tbody.addEventListener('click', (e)=>{
  const btnAg = e.target.closest('.btn-agendar');
  if(btnAg){
    const id = Number(btnAg.getAttribute('data-id'));
    const item = data.find(x=>x.id===id);
    if(item && item.status==='livre'){ item.status='marcado'; render(); }
    return;
  }
  const btnDel = e.target.closest('.btn-del');
  if(btnDel){
    const id = Number(btnDel.getAttribute('data-del'));
    data = data.filter(x=>x.id!==id); render();
  }
});

/* Médico -> auto-preencher CRM/Esp */
selMedico.addEventListener('change', ()=>{
  const idx = selMedico.value;
  if (idx===''){ autoCRM.value=''; autoEsp.value=''; return; }
  const m = medicos[Number(idx)];
  autoCRM.value = m.crm; autoEsp.value = m.especialidade;
});

/* Sliders */
function syncLabels(){
  let i = Number(rngInicio.value), f = Number(rngFim.value);
  if (f < i) { if (document.activeElement === rngInicio) { rngFim.value = i; f = i; } else { rngInicio.value = f; i = f; } }
  document.getElementById('lblInicio').textContent = idxToTime(i);
  document.getElementById('lblFim').textContent = idxToTime(f);
}
[rngInicio, rngFim].forEach(r=> r.addEventListener('input', syncLabels));
syncLabels();

/* Helpers de data */
function parseISO(dstr){ const d = new Date(dstr); if(Number.isNaN(+d)) return null; d.setHours(0,0,0,0); return d; }
function addDays(d, n){ const x = new Date(d); x.setDate(x.getDate()+n); return x; }
function toISODate(d){ const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), da=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${da}`; }

/* Gerar horários – intervalo de datas + pular sábado/domingo (opcional) + refeições */
el('#formAdd').addEventListener('submit', (e)=>{
  e.preventDefault();
  if (selMedico.value===''){ alert('Selecione um médico.'); return; }
  if (!dataInicio.value || !dataFim.value){ alert('Selecione data de início e de fim.'); return; }

  const start = parseISO(dataInicio.value);
  const end   = parseISO(dataFim.value);
  if(!start || !end){ alert('Datas inválidas.'); return; }
  if(end < start){ alert('A data de fim não pode ser antes da data de início.'); return; }

  const incluiSabado = incluiSab.checked;
  const incluiDomingo = incluiDom.checked;

  const m = medicos[Number(selMedico.value)];
  const startIdx = Number(rngInicio.value);
  const endIdx = Number(rngFim.value);
  const stat = el('#fStatus').value;

  if (endIdx === startIdx){ alert('Início e fim iguais. Ajuste os sliders.'); return; }

  let nextId = Math.max(0, ...data.map(x=>x.id)) + 1;

  for(let d = new Date(start); d <= end; d = addDays(d, 1)){
    const dow = d.getDay(); // 0=Dom, 6=Sáb
    if ((dow===6 && !incluiSabado) || (dow===0 && !incluiDomingo)) continue;

    const dataStr = toISODate(d);
    const diaSemana = weekDayPT(dow);

    for (let idx=startIdx; idx<endIdx; idx++){
      if (isMealBreakIdx(idx)) continue; // pula 12:00–13:00 e 18:00–19:00
      const hora = idxToTime(idx);
      data.push({
        id: nextId++,
        medico: m.nome,
        crm: m.crm,
        especialidade: m.especialidade,
        dia: diaSemana,
        data: dataStr,
        hora,
        status: stat
      });
    }
  }
  preencherEspecialidadesFiltro();
  render();
});

/* Boot */
function init(){
  initMedicosSelect();
  preencherEspecialidadesFiltro();
  render();
}
init();
</script>
</body>
</html>
